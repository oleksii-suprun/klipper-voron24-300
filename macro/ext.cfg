[gcode_macro G28]
rename_existing: G028
gcode:
    STATUS_HOMING
    G028 {rawparams}
    STATUS_READY

# Conditional G28 (home if not already homed)
[gcode_macro CG28]
gcode:
    {% if "x" not in printer.toolhead.homed_axes or "y" not in printer.toolhead.homed_axes or "z" not in printer.toolhead.homed_axes %}
    G28
    {% endif %}

# [gcode_macro POWER_OFF_DRYER]
# gcode:
#   {action_call_remote_method(
#     "set_device_power", device="filament_dryer_plug", state="off"
#   )}

# [gcode_macro POWER_ON_DRYER]
# gcode:
#   {action_call_remote_method(
#     "set_device_power", device="filament_dryer_plug", state="on"
#   )}

[gcode_macro PARK]
gcode:
    {% set th = printer.toolhead %}
    G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y//2} Z30  

[gcode_macro G32]
gcode:
    SAVE_GCODE_STATE NAME=STATE_G32
    G90
    CG28
    STATUS_LEVELING
    QUAD_GANTRY_LEVEL
    CG28
    PARK
    STATUS_READY
    RESTORE_GCODE_STATE NAME=STATE_G32

[gcode_macro M141]
gcode:
    {% set s = params.S|default(0)|float %}
    SET_TEMPERATURE_FAN_TARGET temperature_fan="chamber" target={s}